<html>
  <head>
    <style>
      #root {
        width: 800px;
        height: 600px;
        text-align: center;
        margin: auto;
      }
      canvas {
        margin-bottom: 16px;
      }
      body {
        margin: auto;
      }
    </style>
  </head>
  <body>
    <div id="root">
      <canvas width="800" height="600"></canvas>
      <input type="file" accept="image/*" />
    </div>
    <script>
      const overlayViewport = {
        width: 425,
        height: 239,
      };
      const canvas = document.querySelector('canvas');
      const ctx = canvas.getContext('2d');
      const background = new Image();
      const overlay = new Image();
      const input = document.querySelector('input');

      const drawBackground = () => ctx.drawImage(background, 0, 0, 800, 600);
      const drawOverlay = () => {
        ctx.resetTransform();
        drawBackground();
        ctx.filter = 'blur(1px)';
        ctx.rotate((-1.21 * Math.PI) / 180);
        ctx.beginPath();
        ctx.moveTo(40, 322);
        ctx.lineTo(462, 317);
        ctx.lineTo(470, 552);
        ctx.lineTo(36, 564);
        ctx.closePath();
        ctx.clip();
        ctx.drawImage(
          overlay,
          36,
          316,
          overlayViewport.width,
          (overlayViewport.width / overlay.width) * overlay.height
        );
      };
      const readImage = () => {
        const reader = new FileReader();
        reader.onload = (e) => {
          overlay.setAttribute('src', e.target.result);
        };
        reader.readAsDataURL(input.files[0]);
      };
      const init = () => {
        drawBackground();
        input.addEventListener('change', readImage);
      };

      overlay.addEventListener('load', drawOverlay);
      background.addEventListener('load', init);
      background.src = 'image/wong.jpg';
    </script>
  </body>
</html>
